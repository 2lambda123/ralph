FROM ubuntu:bionic
MAINTAINER PyLabs pylabs@allegro.pl

# set UTF-8 locale
RUN apt-get clean && apt-get update
RUN apt-get install locales
RUN locale-gen en_US.UTF-8
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get -y install apt-transport-https gnupg2 ca-certificates
RUN apt-key adv --keyserver  hkp://keyserver.ubuntu.com:80 --recv-keys 379CE192D401AB61
RUN sh -c "echo 'deb https://dl.bintray.com/vi4m/ralph wheezy main' >  /etc/apt/sources.list.d/vi4m_ralph.list"

RUN apt-get update
# TODO: change this after uploading new image to ppa/bintray
#RUN apt-get -y install ralph-core
RUN apt-get -y install python3 python3-dev libmysqlclient-dev
COPY ralph-core_3.0.0-48_amd64.deb /tmp
RUN dpkg -i /tmp/ralph-core_3.0.0-48_amd64.deb
RUN apt-get -f install

ENV PATH=/opt/ralph/ralph-core/bin/:$PATH


ENV RALPH_ADMIN_USERNAME=ralph
ENV RALPH_ADMIN_PASSWORD=ralph
ENV RALPH_ADMIN_EMAIL=admin@ralph.com

# TODO: remove this envs
# DB
ENV DATABASE_NAME=ralph_ng
ENV DATABASE_USER=ralph_ng
ENV DATABASE_PASSWORD=ralph_ng
ENV DATABASE_HOST=127.0.0.1
ENV DATABASE_PORT=3306
ENV DATABASE_ENGINE='transaction_hooks.backends.mysql'

# Redis
ENV REDIS_HOST=127.0.0.1
ENV REDIS_PORT=6379
ENV REDIS_DB=0
ENV REDIS_PASSWORD=""

# TODO: add entrypoint
COPY docker-entrypoint.sh /var/local/ralph/
COPY createsuperuser.py /var/local/ralph/

ENTRYPOINT ["/var/local/ralph/docker-entrypoint.sh"]

# TODO: add command
